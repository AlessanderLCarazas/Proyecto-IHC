<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>LovArtGame</title>

  <!-- update the version number as needed -->
  <script defer src="/__/firebase/11.0.2/firebase-app-compat.js"></script>
  <!-- include only the Firebase features as you need -->
  <script defer src="/__/firebase/11.0.2/firebase-auth-compat.js"></script>
  <script defer src="/__/firebase/11.0.2/firebase-database-compat.js"></script>
  <script defer src="/__/firebase/11.0.2/firebase-firestore-compat.js"></script>
  <script defer src="/__/firebase/11.0.2/firebase-functions-compat.js"></script>
  <script defer src="/__/firebase/11.0.2/firebase-messaging-compat.js"></script>
  <script defer src="/__/firebase/11.0.2/firebase-storage-compat.js"></script>
  <script defer src="/__/firebase/11.0.2/firebase-analytics-compat.js"></script>
  <script defer src="/__/firebase/11.0.2/firebase-remote-config-compat.js"></script>
  <script defer src="/__/firebase/11.0.2/firebase-performance-compat.js"></script>
  <!-- 
      initialize the SDK after all desired features are loaded, set useEmulator to false
      to avoid connecting the SDK to running emulators.
    -->
  <script defer src="/__/firebase/init.js?useEmulator=true"></script>
  <script src="https://pixijs.download/v7.1.1/pixi.min.js"></script>

</head>

<body>
  <script>
    let app = new PIXI.Application({
      width: window.innerWidth,
      height: window.innerHeight,
      antialiasing: true,
      transparent: false,
      resolution: 1,
    });
    app.renderer.backgroundColor = "0xff1234";
  
    document.body.appendChild(app.view);
  
    let characterSprite;
  
    async function loadMap() {
      const texture = await PIXI.Assets.load("map.jpg");
      const mapSprite = new PIXI.Sprite(texture);
  
      // Escalar el sprite para que se ajuste a la ventana
      mapSprite.width = app.screen.width;
      mapSprite.height = app.screen.height;
  
      // Hacer que el mapa sea interactivo
      mapSprite.interactive = true;
      mapSprite.buttonMode = true;
  
      // Añadir evento de clic
      mapSprite.on("pointerdown", (event) => {
        const position = event.data.global; // Obtener posición del clic
        moveCharacterTo(position.x, position.y);
      });
  
      // Añadir el sprite al stage
      app.stage.addChild(mapSprite);
  
      loadCharacter();
    }
  
    async function loadCharacter() {
      const characterTexture = await PIXI.Assets.load("character.png");
      characterSprite = new PIXI.Sprite(characterTexture);
  
      characterSprite.x = app.screen.width / 1.4;
      characterSprite.y = app.screen.height / 2;
  
      characterSprite.anchor.set(0.5, 0.5);
      characterSprite.scale.set(1, 1);
  
      app.stage.addChild(characterSprite);
    }
  
    function moveCharacterTo(targetX, targetY) {
      const speed = 5; // Velocidad del personaje
      app.ticker.add(function animate() {
        // Calcular las diferencias en X y Y
        const dx = targetX - characterSprite.x;
        const dy = targetY - characterSprite.y;
  
        // Calcular la distancia
        const distance = Math.sqrt(dx * dx + dy * dy);
  
        // Si la distancia es pequeña, detener el movimiento
        if (distance < speed) {
          characterSprite.x = targetX;
          characterSprite.y = targetY;
          app.ticker.remove(animate);
          return;
        }
  
        // Calcular el ángulo y mover el sprite
        const angle = Math.atan2(dy, dx);
        characterSprite.x += Math.cos(angle) * speed;
        characterSprite.y += Math.sin(angle) * speed;
      });
    }
  
    loadMap();
  </script>
</body>
</html>